name: steam_reviews_system
services:
  rabbitmq:
    image: rabbitmq:3-management
    container_name: rabbitmq
    ports:
    - 15672:15672
    networks:
    - net
    volumes:
    - rabbitmq_data:/var/lib/rabbitmq
    logging:
      driver: none
    healthcheck:
      test: rabbitmq-diagnostics -q ping
      interval: 5s
      timeout: 10s
      retries: '5'
  client1:
    container_name: client1
    image: client:latest
    entrypoint: python3 /main.py
    volumes:
    - ./data/:/data
    networks:
    - net
    depends_on:
      rabbitmq:
        condition: service_healthy
    restart: on-failure
  filter_columns0:
    image: filter_columns:latest
    container_name: filter_columns0
    environment:
    - NODE_ID=0
    - INSTANCES_OF_MYSELF=2
    depends_on:
      rabbitmq:
        condition: service_healthy
    networks:
    - net
    restart: on-failure
  filter_columns1:
    image: filter_columns:latest
    container_name: filter_columns1
    environment:
    - NODE_ID=1
    - INSTANCES_OF_MYSELF=2
    depends_on:
      rabbitmq:
        condition: service_healthy
    networks:
    - net
    restart: on-failure
  drop_columns0:
    image: drop_nulls:latest
    container_name: drop_nulls0
    environment:
    - NODE_ID=0
    - COUNT_BY_PLATFORM_NODES=1
    - INSTANCES_OF_MYSELF=2
    - Q2_FORWARD_NODES=2
    - Q3_FORWARD_NODES=2
    - Q4_FORWARD_NODES=2
    - Q5_FORWARD_NODES=2
    depends_on:
      rabbitmq:
        condition: service_healthy
    networks:
    - net
    restart: on-failure
  drop_columns1:
    image: drop_nulls:latest
    container_name: drop_nulls1
    environment:
    - NODE_ID=1
    - COUNT_BY_PLATFORM_NODES=1
    - INSTANCES_OF_MYSELF=2
    - Q2_FORWARD_NODES=2
    - Q3_FORWARD_NODES=2
    - Q4_FORWARD_NODES=2
    - Q5_FORWARD_NODES=2
    depends_on:
      rabbitmq:
        condition: service_healthy
    networks:
    - net
    restart: on-failure
  q1_counter0:
    container_name: q1_counter0
    image: counter_by_platform:latest
    entrypoint: python3 /main.py
    environment:
    - NODE_ID=0
    - CONSUME_QUEUE_SUFIX=q1_platform
    - PUBLISH_QUEUE=Q1
    depends_on:
      rabbitmq:
        condition: service_healthy
    networks:
    - net
    restart: on-failure
  q2_top_k0:
    image: top_k:latest
    container_name: q2_top_k0
    environment:
    - INPUT_TOP_K_QUEUE_NAME=0_q2_indie_games_from_last_decade
    - OUTPUT_TOP_K_QUEUE_NAME=Q2
    - K=10
    depends_on:
      rabbitmq:
        condition: service_healthy
    networks:
    - net
    restart: on-failure
  q2_filter_indie_games0:
    image: filter_by_column_value:latest
    container_name: q2_indie_games0
    environment:
    - NODE_ID=0
    - RECIVING_QUEUE_NAME=q2_games
    - FORWARDING_QUEUE_NAME=q2_indie_games
    - AMOUNT_OF_FORWARDING_QUEUES=1
    - LOGGING_LEVEL=DEBUG
    - COLUMN_NUMBER_TO_USE=4
    - VALUE_TO_FILTER_BY=indie
    - CRITERIA=CONTAINS
    - COLUMNS_TO_KEEP=0,1,2,3
    - INSTANCES_OF_MYSELF=2
    depends_on:
      rabbitmq:
        condition: service_healthy
    networks:
    - net
    restart: on-failure
  q2_filter_indie_games1:
    image: filter_by_column_value:latest
    container_name: q2_indie_games1
    environment:
    - NODE_ID=1
    - RECIVING_QUEUE_NAME=q2_games
    - FORWARDING_QUEUE_NAME=q2_indie_games
    - AMOUNT_OF_FORWARDING_QUEUES=1
    - LOGGING_LEVEL=DEBUG
    - COLUMN_NUMBER_TO_USE=4
    - VALUE_TO_FILTER_BY=indie
    - CRITERIA=CONTAINS
    - COLUMNS_TO_KEEP=0,1,2,3
    - INSTANCES_OF_MYSELF=2
    depends_on:
      rabbitmq:
        condition: service_healthy
    networks:
    - net
    restart: on-failure
  q2_filter_indie_games_from_last_decade0:
    image: filter_by_column_value:latest
    container_name: q2_indie_games_from_last_decade0
    environment:
    - NODE_ID=0
    - RECIVING_QUEUE_NAME=0_q2_indie_games
    - FORWARDING_QUEUE_NAME=q2_indie_games_from_last_decade
    - AMOUNT_OF_FORWARDING_QUEUES=1
    - LOGGING_LEVEL=DEBUG
    - COLUMN_NUMBER_TO_USE=2
    - VALUE_TO_FILTER_BY=201
    - CRITERIA=CONTAINS
    - COLUMNS_TO_KEEP=1,3
    - INSTANCES_OF_MYSELF=2
    depends_on:
      rabbitmq:
        condition: service_healthy
    networks:
    - net
    restart: on-failure
  q2_filter_indie_games_from_last_decade1:
    image: filter_by_column_value:latest
    container_name: q2_indie_games_from_last_decade1
    environment:
    - NODE_ID=1
    - RECIVING_QUEUE_NAME=0_q2_indie_games
    - FORWARDING_QUEUE_NAME=q2_indie_games_from_last_decade
    - AMOUNT_OF_FORWARDING_QUEUES=1
    - LOGGING_LEVEL=DEBUG
    - COLUMN_NUMBER_TO_USE=2
    - VALUE_TO_FILTER_BY=201
    - CRITERIA=CONTAINS
    - COLUMNS_TO_KEEP=1,3
    - INSTANCES_OF_MYSELF=2
    depends_on:
      rabbitmq:
        condition: service_healthy
    networks:
    - net
    restart: on-failure
volumes:
  rabbitmq_data: {}
networks:
  net:
    ipam:
      driver: default
      config:
      - subnet: 172.25.125.0/24
